Jscex.Async={};Jscex.Async.CanceledError=function(){};Jscex.Async.Task=function(a){this._delegate=a;this._handlers=[];this.status="ready"};
Jscex.Async.Task.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');var a=this;this.status="running";this._delegate.onStart(function(e,g){if(a.status!="running")throw Error('Callback can only be used in "running" status.');if(e=="success")a.result=g,a.status="succeeded";else if(e=="failure")g instanceof Jscex.Async.CanceledError?a.status="canceled":(a.error=g,a.status="failed");else throw Error("Unsupported type: "+e);var f=a._handlers;delete a._handlers;
for(var b=0;b<f.length;b++)f[b](a)})},addListener:function(a){if(!this._handlers)throw Error('Listeners can only be added in "ready" or "running" status.');this._handlers.push(a)}};
(function(){var a=function(){};a.prototype={binder:"$await",Start:function(g,a){return new Jscex.Async.Task({onStart:function(b){a.next(g,function(a,g){if(a=="normal"||a=="return")b("success",g);else if(a=="throw")b("failure",g);else throw Error("Unsupported type: "+a);})}})},Bind:function(a,f){return{next:function(b,d){var c=function(c){if(c.status=="succeeded"){var e;try{e=f.call(b,a.result)}catch(h){d("throw",h);return}e.next(b,d)}else d("throw",a.error)};a.status=="ready"?(a.addListener(c),a.start()):
a.status=="running"?a.addListener(c):c(a)}}}};for(var e in Jscex.builderBase)a.prototype[e]=Jscex.builderBase[e];Jscex.builders.async=new a;a=Jscex.Async;a.sleep=function(a){return new Jscex.Async.Task({onStart:function(f){setTimeout(function(){f("success")},a)}})};a.onEvent=function(a,f){var b="on"+f;return new Jscex.Async.Task({onStart:function(d){a[b]=function(c){a[b]=null;d("success",c)}}})};a.parallel=function(a){return new Jscex.Async.Task({onStart:function(f){for(var b=[],d=0;d<a.length;d++){var c=
a[d];c._p_idx=d;b.push(c)}var e=!1,j=b.length,h=[],i=function(a){if(!e)if(a.status=="failed")e=!0,f("failure",{task:a});else if(a.status=="succeeded")h[a._p_idx]=a.result,j--,j==0&&(e=!0,f("success",h))};for(d=0;d<b.length;d++)switch(c=b[d],c.status){case "failed":case "succeeded":i(c);break;case "running":c.addListener(i);break;case "ready":c.addListener(i),c.start()}}})}})();
