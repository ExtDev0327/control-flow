(function(){var m=function(j){if(!j.modules||!j.modules["async-powerpack"]){if(!j.modules||!j.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var k=j.Async,i=k.Task,l=k.CanceledError;k.sleep=function(b,e){return i.create(function(d){e&&e.isCancellationRequested&&d.complete("failure",new l);var f,a;e&&(a=function(){clearTimeout(f);d.complete("failure",new l)});f=setTimeout(function(){e&&e.unregister(a);d.complete("success")},b);e&&e.register(a)})};
k.onEvent=function(b,e,d){return i.create(function(f){d&&d.isCancellationRequested&&f.complete("failure",new l);var a,c;d&&(c=function(){b.removeEventListener?b.removeEventListener(e,a):b.detachEvent(e,a);f.complete("failure",new l)});a=function(a){d&&d.unregister(c);f.complete("success",a)};b.addEventListener?b.addEventListener(e,a):b.attachEvent(e,a);d&&d.register(c)})};i.whenAll=function(b){Object.prototype.toString.call(b)==="[object Array]"||(b=arguments);return i.create(function(e){for(var d=
{},f=[],a=0;a<b.length;a++)d[b[a].id]=a,f.push(g);var c=[],h=function(a){if(a.error){for(var b=0;b<f.length;b++)f[b].removeEventListener("complete",h);e.complete("failure",a.error)}else c[d[a.id]]=a.result,a=f.indexOf(a),f.splice(a,1),f.length==0&&(finished=!0,e.complete("success",c))};for(a=0;a<b.length;a++){var g=b[a];switch(g.status){case "ready":g.addEventListener("complete",h);g.start();break;case "running":g.addEventListener("complete",h);break;default:h(g)}}})};i.whenAny=function(){var b,e=
!1;if(arguments.length==1){var d=arguments[0];if(i.isTask(d))return d;else b=d,e=Object.prototype.toString.call(b)==="[object Array]"}else b=arguments,e=!0;return i.create(function(d){var a={};if(e)for(var c=0;c<b.length;c++)a[b[c].id]=c;else for(c in b)a[b[c].id]=c;var h=function(c){for(var g in a)b[a[g]].removeEventListener("complete",h);e?d.complete("success",{index:a[c.id],task:c}):d.complete("success",{name:a[c.id],task:c})},g;for(g in a)switch(c=b[a[g]],c.status){case "ready":c.addEventListener("complete",
h);c.start();break;case "running":c.addEventListener("complete",h);break;default:h(c)}})};j.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=m:m(Jscex)})();
