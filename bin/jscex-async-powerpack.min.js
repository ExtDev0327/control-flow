(function(){var l=function(g){this.children=[];if(g)for(var b=0;b<g.length;b++)this.children.push(g[b])};l.prototype={_typeId:"4a73efb8-c2e2-4305-a05c-72385288650a",message:"This is an error contains sub-errors, please check the 'children' collection for more details.",isTypeOf:function(g){return g._typeId=="4a73efb8-c2e2-4305-a05c-72385288650a"}};var n=function(g){if(g.length<=1)return null;for(var b=[],c=1;c<g.length;c++)b.push(g[c]);return b},o=function(g,b){for(var c=[],i=0;i<g.length;i++)c.push(g[i]);
for(;c.length<b;)c.push(void 0);return c},k=function(g){if(!g.modules["async-powerpack"]){if(!g.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var b=g.Async,c=b.Task,i=b.CanceledError;b.AggregateError=l;b.sleep=function(e,a){return c.create(function(c){a&&a.isCancellationRequested&&c.complete("failure",new i);var d,h;a&&(h=function(){clearTimeout(d);c.complete("failure",new i)});d=setTimeout(function(){a&&a.unregister(h);c.complete("success")},
e);a&&a.register(h)})};b.onEvent=function(e,a,j){return c.create(function(d){j&&j.isCancellationRequested&&d.complete("failure",new i);var h=function(){e.removeEventListener?e.removeEventListener(a,f):e.removeListener?e.removeListener(a,f):e.detachEvent(a,f)},f,c;j&&(c=function(){h();d.complete("failure",new i)});f=function(a){j&&j.unregister(c);h();d.complete("success",a)};e.addEventListener?e.addEventListener(a,f):e.addListener?e.addListener(a,f):e.attachEvent(a,f);j&&j.register(c)})};c.whenAll=
function(){var e;if(arguments.length==1){var a=arguments[0];e=c.isTask(a)?[a]:a}else{e=Array(arguments.length);for(a=0;a<arguments.length;a++)e[a]=arguments[a]}return c.create(function(a){var d={},h;for(h in e)if(e.hasOwnProperty(h)){var f=e[h];f&&(c.isTask(f)||(e[h]=f=c.whenAll(f)),d[f.id]=h)}for(var b in d)d.hasOwnProperty(b)&&(f=e[d[b]],f.status=="ready"&&f.start());var g=function(){var f=Object.prototype.toString.call(e)==="[object Array]"?Array(e.length):{},c=[],h;for(h in d)if(d.hasOwnProperty(h)){var b=
d[h],g=e[b];g.error?c.push(g.error):f[b]=g.result}c.length>0?a.complete("failure",new l(c)):a.complete("success",f)},m=0;for(b in d)d.hasOwnProperty(b)&&(h=d[b],f=e[h],f.status=="running"&&(m++,f.addEventListener("complete",function(){--m==0&&g()})));m==0&&g()})};c.whenAny=function(){var e={};if(arguments.length==1){var a=arguments[0];c.isTask(a)?e[0]=a:e=a}else for(a=0;a<arguments.length;a++)e[a]=arguments[a];return c.create(function(a){var d={},h;for(h in e)if(e.hasOwnProperty(h)){var f=e[h];c.isTask(f)&&
(d[f.id]=h)}for(var b in d)f=e[d[b]],f.status=="ready"&&f.start();for(b in d)if(h=d[b],f=e[h],f.error||f.status=="succeeded"){a.complete("success",{key:h,task:f});return}var g=function(){for(var f in d)e[d[f]].removeEventListener("complete",g);a.complete("success",{key:d[this.id],task:this})};for(b in d)e[d[b]].addEventListener("complete",g)})};if(!b.Jscexify)b.Jscexify={};b=b.Jscexify;b.fromStandard=function(e){var a=n(arguments);return function(){var b=this,d=o(arguments,e.length-1);return c.create(function(c){d.push(function(f,
e){if(f)c.complete("failure",f);else if(a){for(var b={},d=0;d<a.length;d++)b[a[d]]=arguments[d+1];return c.complete("success",b)}else c.complete("success",e)});e.apply(b,d)})}};c.prototype.then=c.prototype.continueWith=function(e){var a=this;return c.create(function(c){var d=function(){this.error?c.complete("failure",this.error):c.complete("success",this.result)},b=function(){if(this.error)return c.complete("failure",this.error);var a;try{a=e(this.result)}catch(b){return c.complete("failure",b)}a.status==
"ready"&&a.start();a.status=="running"?a.addEventListener("complete",d):d.call(a)};a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",b):b.call(a)})};b.fromCallback=function(b){var a=n(arguments);return function(){var g=this,d=o(arguments,b.length-1);return c.create(function(c){d.push(function(b){if(a){for(var e={},d=0;d<a.length;d++)e[a[d]]=arguments[d];c.complete("success",e)}else c.complete("success",b)});b.apply(g,d)})}};g.modules["async-powerpack"]=!0}},p=typeof define===
"function"&&!define.amd,q=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=k;else if(p)define("jscex-async-powerpack",["jscex-async"],function(g,b,c){c.exports.init=k});else if(q)define("jscex-async-powerpack",["jscex-async"],function(){return{init:k}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');k(Jscex)}})();
