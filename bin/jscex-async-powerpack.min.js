(function(){var g=function(c){if(!c.modules||!c.modules["async-powerpack"]){if(!c.modules||!c.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var f=c.Async,j=f.Task,g=f.CanceledError;f.sleep=function(b,d){return new j({onStart:function(e){d&&d.throwIfCancellationRequested();var i,a;d&&(a=function(){clearTimeout(i);e("failure",new g)});i=setTimeout(function(){d&&d.unregister(a);e("success")},b);d&&d.register(a)}})};f.onEvent=function(b,d,e){return new j({onStart:function(i){e&&
e.throwIfCancellationRequested();var a,c;e&&(c=function(){b.removeEventListener?b.removeEventListener(d,a):b.detachEvent(d,a);i("failure",new g)});a=function(a){e&&e.unregister(c);i("success",a)};b.addEventListener?b.addEventListener(d,a):b.attachEvent(d,a);e&&e.register(c)}})};j.whenAll=function(b){return new j({onStart:function(d){for(var e={},c=[],a=0;a<b.length;a++)e[b[a].id]=a,c.push(h);var g=[],f=function(a){if(a.error){for(var b=0;b<tasksClone.length;b++)c[b].removeListener(f);d("failure",
a.error)}else g[e[a.id]]=a.result,a=tasksClone.indexOf(a),c.splice(a,1),c.length==0&&(finished=!0,d("success",g))};for(a=0;a<b.length;a++){var h=b[a];switch(h.status){case "ready":h.addListener(f);h.start();break;case "running":h.addListener(f);break;default:f(h)}}}})};c.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=g:g(Jscex)})();
