(function(){var l=function(h){if(h.length<=1)return null;for(var g=[],f=1;f<h.length;f++)g.push(h[f]);return g},m=function(h,g){for(var f=[],i=0;i<h.length;i++)f.push(h[i]);for(;f.length<g;)f.push(void 0);return f},n=function(h){if(!h.modules||!h.modules["async-powerpack"]){if(!h.modules||!h.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var g=h.Async,f=g.Task,i=g.CanceledError;g.sleep=function(b,e){return f.create(function(c){e&&e.isCancellationRequested&&
c.complete("failure",new i);var j,d;e&&(d=function(){clearTimeout(j);c.complete("failure",new i)});j=setTimeout(function(){e&&e.unregister(d);c.complete("success")},b);e&&e.register(d)})};g.onEvent=function(b,e,c){return f.create(function(j){c&&c.isCancellationRequested&&j.complete("failure",new i);var d,a;c&&(a=function(){b.removeEventListener?b.removeEventListener(e,d):b.removeListener?b.removeListener(e,d):b.detachEvent(e,d);j.complete("failure",new i)});d=function(b){c&&c.unregister(a);j.complete("success",
b)};b.addEventListener?b.addEventListener(e,d):b.addListener?b.addListener(e,d):b.attachEvent(e,d);c&&c.register(a)})};f.whenAll=function(){var b,e=!1;if(arguments.length==1){var c=arguments[0];if(f.isTask(c))return c;else b=c,e=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);e=!0}return f.create(function(c){var d={};if(e)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;for(var f in d)if(a=b[d[f]],a.error){c.complete("failure",
a.error);return}var g=e?[]:{},k=1,h=function(a){if(a.error){for(var e in d)b[d[e]].removeEventListener("complete",h);c.complete("failure",a.error)}else g[d[a.id]]=a.result,k--,k==0&&c.complete("success",g)};for(f in d)switch(k++,a=b[d[f]],a.status){case "ready":a.addEventListener("complete",h);a.start();break;case "running":a.addEventListener("complete",h);break;default:h(a)}k==1?c.complete("success",g):k--})};f.whenAny=function(){var b,e=!1;if(arguments.length==1){var c=arguments[0];if(f.isTask(c))return c;
else b=c,e=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);e=!0}return f.create(function(c){var d={};if(e)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;var f=function(a){for(var g in d)b[d[g]].removeEventListener("complete",f);e?c.complete("success",{index:d[a.id],task:a}):c.complete("success",{name:d[a.id],task:a})},g;for(g in d)switch(a=b[d[g]],a.status){case "ready":a.addEventListener("complete",f);a.start();
break;case "running":a.addEventListener("complete",f);break;default:f(a)}})};if(!g.Jscexify)g.Jscexify={};g=g.Jscexify;g.fromStandard=function(b){var e=l(arguments);return function(){var c=this,g=m(arguments,b.length-1);return f.create(function(d){g.push(function(a,b){if(a)d.complete("failure",a);else if(e){for(var c={},f=0;f<e.length;f++)c[e[f]]=arguments[f+1];return d.complete("success",c)}else d.complete("success",b)});b.apply(c,g)})}};g.fromCallback=function(b){var e=l(arguments);return function(){var c=
this,g=m(arguments,b.length-1);return f.create(function(d){g.push(function(a){if(e){for(var b={},c=0;c<e.length;c++)b[e[c]]=arguments[c];d.complete("success",b)}else d.complete("success",a)});b.apply(c,g)})}};h.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=n:n(Jscex)})();
