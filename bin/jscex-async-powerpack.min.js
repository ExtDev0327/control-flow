(function(){var m=function(g){if(g.length<=1)return null;for(var e=[],c=1;c<g.length;c++)e.push(g[c]);return e},n=function(g,e){for(var c=[],j=0;j<g.length;j++)c.push(g[j]);for(;c.length<e;)c.push(void 0);return c},l=function(g){if(!g.modules["async-powerpack"]){if(!g.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var e=g.Async,c=e.Task,j=e.CanceledError;e.sleep=function(a,b){return c.create(function(d){b&&b.isCancellationRequested&&d.complete("failure",
new j);var k,h;b&&(h=function(){clearTimeout(k);d.complete("failure",new j)});k=setTimeout(function(){b&&b.unregister(h);d.complete("success")},a);b&&b.register(h)})};e.onEvent=function(a,b,d){return c.create(function(k){d&&d.isCancellationRequested&&k.complete("failure",new j);var h=function(){a.removeEventListener?a.removeEventListener(b,f):a.removeListener?a.removeListener(b,f):a.detachEvent(b,f)},f,i;d&&(i=function(){h();k.complete("failure",new j)});f=function(a){d&&d.unregister(i);h();k.complete("success",
a)};a.addEventListener?a.addEventListener(b,f):a.addListener?a.addListener(b,f):a.attachEvent(b,f);d&&d.register(i)})};c.whenAll=function(){var a={},b;if(arguments.length==1){var d=arguments[0];c.isTask(d)?(a[0]=d,b=!0):(a=d,b=Object.prototype.toString.call(a)==="[object Array]")}else{for(d=0;d<arguments.length;d++)a[d]=arguments[d];b=!0}return c.create(function(d){var h={},f;for(f in a)h[a[f].id]=f;for(f in a){var i=a[f];i.status=="ready"&&i.start()}for(f in a)if(i=a[f],i.error){d.complete("failure",
i.error);return}var c=b?[]:{},e=function(b){if(b.error){for(var f in a)a[f].removeEventListener("complete",e);d.complete("failure",b.error)}else f=h[b.id],c[f]=b.result,delete a[f],delete h[b.id],g--,g==0&&d.complete("success",c)},g=0;for(f in a)i=a[f],i.status=="succeeded"?(c[f]=i.result,delete a[f],delete h[i.id]):(g++,i.addEventListener("complete",e));g==0&&d.complete("success",c)})};c.whenAny=function(){var a={};if(arguments.length==1){var b=arguments[0];c.isTask(b)?a[0]=b:a=b}else for(b=0;b<
arguments.length;b++)a[b]=arguments[b];return c.create(function(b){for(var c in a){var h=a[c];h.status=="ready"&&h.start()}for(c in a)if(h=a[c],h.error||h.status=="succeeded"){b.complete("success",{key:c,task:h});return}var f=function(c){for(var h in a)a[h].removeEventListener("complete",f);b.complete("success",{key:h,task:c})};for(c in a)a[c].addEventListener("complete",f)})};if(!e.Jscexify)e.Jscexify={};e=e.Jscexify;e.fromStandard=function(a){var b=m(arguments);return function(){var d=this,e=n(arguments,
a.length-1);return c.create(function(c){e.push(function(a,d){if(a)c.complete("failure",a);else if(b){for(var e={},g=0;g<b.length;g++)e[b[g]]=arguments[g+1];return c.complete("success",e)}else c.complete("success",d)});a.apply(d,e)})}};e.fromCallback=function(a){var b=m(arguments);return function(){var d=this,e=n(arguments,a.length-1);return c.create(function(c){e.push(function(a){if(b){for(var d={},e=0;e<b.length;e++)d[b[e]]=arguments[e];c.complete("success",d)}else c.complete("success",a)});a.apply(d,
e)})}};g.modules["async-powerpack"]=!0}},o=typeof define!=="undefined"&&define.amd;if(typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports)module.exports.init=l;else if(o)define("jscex-async-powerpack",["jscex-async"],function(){return{init:l}});else{if(typeof Jscex==="undefined")throw Error('Missing root object, please load "jscex" module first.');l(Jscex)}})();
