(function(){var n=function(j){if(j.length<=1)return null;for(var g=[],f=1;f<j.length;f++)g.push(j[f]);return g},o=function(j,g){for(var f=[],k=0;k<j.length;k++)f.push(j[k]);for(;f.length<g;)f.push(void 0);return f},m=function(j){if(!j.modules["async-powerpack"]){if(!j.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var g=j.Async,f=g.Task,k=g.CanceledError;g.sleep=function(c,b){return f.create(function(d){b&&b.isCancellationRequested&&d.complete("failure",
new k);var i,e;b&&(e=function(){clearTimeout(i);d.complete("failure",new k)});i=setTimeout(function(){b&&b.unregister(e);d.complete("success")},c);b&&b.register(e)})};g.onEvent=function(c,b,d){return f.create(function(i){d&&d.isCancellationRequested&&i.complete("failure",new k);var e=function(){c.removeEventListener?c.removeEventListener(b,a):c.removeListener?c.removeListener(b,a):c.detachEvent(b,a)},a,h;d&&(h=function(){e();i.complete("failure",new k)});a=function(a){d&&d.unregister(h);e();i.complete("success",
a)};c.addEventListener?c.addEventListener(b,a):c.addListener?c.addListener(b,a):c.attachEvent(b,a);d&&d.register(h)})};f.whenAll=function(){var c={},b;if(arguments.length==1){var d=arguments[0];f.isTask(d)?(c[0]=d,b=!0):(c=d,b=Object.prototype.toString.call(c)==="[object Array]")}else{for(d=0;d<arguments.length;d++)c[d]=arguments[d];b=!0}return f.create(function(d){var e={},a;for(a in c)if(c.hasOwnProperty(a)){var h=c[a];f.isTask(h)&&(e[h.id]=a)}for(var l in e)h=c[e[l]],h.status=="ready"&&h.start();
for(l in e)if(h=c[e[l]],h.error){d.complete("failure",h.error);return}var g=b?[]:{},j=function(a){if(a.error){for(var b in e)c[e[b]].removeEventListener("complete",j);d.complete("failure",a.error)}else g[e[a.id]]=a.result,delete e[a.id],k--,k==0&&d.complete("success",g)},k=0;for(l in e)a=e[l],h=c[a],h.status=="succeeded"?(g[a]=h.result,delete e[h.id]):(k++,h.addEventListener("complete",j));k==0&&d.complete("success",g)})};f.whenAny=function(){var c={};if(arguments.length==1){var b=arguments[0];f.isTask(b)?
c[0]=b:c=b}else for(b=0;b<arguments.length;b++)c[b]=arguments[b];return f.create(function(b){var i={},e;for(e in c)if(c.hasOwnProperty(e)){var a=c[e];f.isTask(a)&&(i[a.id]=e)}for(var h in i)a=c[i[h]],a.status=="ready"&&a.start();for(h in i)if(e=i[h],a=c[e],a.error||a.status=="succeeded"){b.complete("success",{key:e,task:a});return}var g=function(a){for(var e in i)c[i[e]].removeEventListener("complete",g);b.complete("success",{key:i[a.id],task:a})};for(h in i)c[i[h]].addEventListener("complete",g)})};
if(!g.Jscexify)g.Jscexify={};g=g.Jscexify;g.fromStandard=function(c){var b=n(arguments);return function(){var d=this,i=o(arguments,c.length-1);return f.create(function(e){i.push(function(a,c){if(a)e.complete("failure",a);else if(b){for(var d={},f=0;f<b.length;f++)d[b[f]]=arguments[f+1];return e.complete("success",d)}else e.complete("success",c)});c.apply(d,i)})}};f.prototype.then=f.prototype.continueWith=function(c){var b=this;return f.create(function(d){var f=function(a){a.error?d.complete("failure",
a.error):d.complete("success",a.result)},e=function(a){if(a.error)return d.complete("failure",a.error);var b;try{b=c(a.result)}catch(e){return d.complete("failure",e)}a=b;a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",f):f(a)};b.status=="ready"&&b.start();b.status=="running"?b.addEventListener("complete",e):e(b)})};g.fromCallback=function(c){var b=n(arguments);return function(){var d=this,g=o(arguments,c.length-1);return f.create(function(e){g.push(function(a){if(b){for(var c=
{},d=0;d<b.length;d++)c[b[d]]=arguments[d];e.complete("success",c)}else e.complete("success",a)});c.apply(d,g)})}};j.modules["async-powerpack"]=!0}},p=typeof define==="function"&&!define.amd,q=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=m;else if(p)define("jscex-async-powerpack",["jscex-async"],function(j,g,f){f.exports.init=m});else if(q)define("jscex-async-powerpack",["jscex-async"],
function(){return{init:m}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');m(Jscex)}})();
