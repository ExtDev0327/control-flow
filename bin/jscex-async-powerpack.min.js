(function(){var m=function(h){if(h.length<=1)return null;for(var f=[],d=1;d<h.length;d++)f.push(h[d]);return f},n=function(h,f){for(var d=[],i=0;i<h.length;i++)d.push(h[i]);for(;d.length<f;)d.push(void 0);return d},l=function(h){if(!h.modules["async-powerpack"]){if(!h.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var f=h.Async,d=f.Task,i=f.CanceledError;f.sleep=function(b,a){return d.create(function(j){a&&a.isCancellationRequested&&j.complete("failure",
new i);var c,g;a&&(g=function(){clearTimeout(c);j.complete("failure",new i)});c=setTimeout(function(){a&&a.unregister(g);j.complete("success")},b);a&&a.register(g)})};f.onEvent=function(b,a,j){return d.create(function(c){j&&j.isCancellationRequested&&c.complete("failure",new i);var g=function(){b.removeEventListener?b.removeEventListener(a,e):b.removeListener?b.removeListener(a,e):b.detachEvent(a,e)},e,d;j&&(d=function(){g();c.complete("failure",new i)});e=function(a){j&&j.unregister(d);g();c.complete("success",
a)};b.addEventListener?b.addEventListener(a,e):b.addListener?b.addListener(a,e):b.attachEvent(a,e);j&&j.register(d)})};d.whenAll=function(){var b;if(arguments.length==1){var a=arguments[0];b=d.isTask(a)?[a]:a}else{b=Array(arguments.length);for(a=0;a<arguments.length;a++)b[a]=arguments[a]}return d.create(function(a){var c={},g;for(g in b)if(b.hasOwnProperty(g)){var e=b[g];e&&(d.isTask(e)||(b[g]=e=d.whenAll(e)),c[e.id]=g)}for(var k in c)c.hasOwnProperty(k)&&(e=b[c[k]],e.status=="ready"&&e.start());
for(k in c)if(c.hasOwnProperty(k)&&(e=b[c[k]],e.error)){a.complete("failure",e.error);return}var f=Object.prototype.toString.call(b)==="[object Array]"?Array(b.length):{},h=0,i=function(){if(this.error){for(var e in c)c.hasOwnProperty(e)&&b[c[e]].removeEventListener("complete",i);a.complete("failure",this.error)}else f[c[this.id]]=this.result,delete c[this.id],h--,h==0&&a.complete("success",f)};for(k in c)if(c.hasOwnProperty(k))g=c[k],e=b[g],e.status=="succeeded"?(f[g]=e.result,delete c[e.id]):(h++,
e.addEventListener("complete",i));h==0&&a.complete("success",f)})};d.whenAny=function(){var b={};if(arguments.length==1){var a=arguments[0];d.isTask(a)?b[0]=a:b=a}else for(a=0;a<arguments.length;a++)b[a]=arguments[a];return d.create(function(a){var c={},g;for(g in b)if(b.hasOwnProperty(g)){var e=b[g];d.isTask(e)&&(c[e.id]=g)}for(var f in c)e=b[c[f]],e.status=="ready"&&e.start();for(f in c)if(g=c[f],e=b[g],e.error||e.status=="succeeded"){a.complete("success",{key:g,task:e});return}var h=function(){for(var e in c)b[c[e]].removeEventListener("complete",
h);a.complete("success",{key:c[this.id],task:this})};for(f in c)b[c[f]].addEventListener("complete",h)})};if(!f.Jscexify)f.Jscexify={};f=f.Jscexify;f.fromStandard=function(b){var a=m(arguments);return function(){var f=this,c=n(arguments,b.length-1);return d.create(function(g){c.push(function(e,b){if(e)g.complete("failure",e);else if(a){for(var c={},d=0;d<a.length;d++)c[a[d]]=arguments[d+1];return g.complete("success",c)}else g.complete("success",b)});b.apply(f,c)})}};d.prototype.then=d.prototype.continueWith=
function(b){var a=this;return d.create(function(d){var c=function(){this.error?d.complete("failure",this.error):d.complete("success",this.result)},g=function(){if(this.error)return d.complete("failure",this.error);var a;try{a=b(this.result)}catch(g){return d.complete("failure",g)}a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",c):c.call(a)};a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",g):g.call(a)})};f.fromCallback=function(b){var a=
m(arguments);return function(){var f=this,c=n(arguments,b.length-1);return d.create(function(d){c.push(function(b){if(a){for(var c={},f=0;f<a.length;f++)c[a[f]]=arguments[f];d.complete("success",c)}else d.complete("success",b)});b.apply(f,c)})}};h.modules["async-powerpack"]=!0}},o=typeof define==="function"&&!define.amd,p=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=l;else if(o)define("jscex-async-powerpack",
["jscex-async"],function(h,f,d){d.exports.init=l});else if(p)define("jscex-async-powerpack",["jscex-async"],function(){return{init:l}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');l(Jscex)}})();
