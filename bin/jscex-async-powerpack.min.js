(function(){var m=function(g){if(g.length<=1)return null;for(var d=[],b=1;b<g.length;b++)d.push(g[b]);return d},n=function(g,d){for(var b=[],h=0;h<g.length;h++)b.push(g[h]);for(;b.length<d;)b.push(void 0);return b},l=function(g){if(!g.modules["async-powerpack"]){if(!g.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var d=g.Async,b=d.Task,h=d.CanceledError;d.sleep=function(a,c){return b.create(function(e){c&&c.isCancellationRequested&&e.complete("failure",
new h);var j,k;c&&(k=function(){clearTimeout(j);e.complete("failure",new h)});j=setTimeout(function(){c&&c.unregister(k);e.complete("success")},a);c&&c.register(k)})};d.onEvent=function(a,c,e){return b.create(function(j){e&&e.isCancellationRequested&&j.complete("failure",new h);var k=function(){a.removeEventListener?a.removeEventListener(c,f):a.removeListener?a.removeListener(c,f):a.detachEvent(c,f)},f,b;e&&(b=function(){k();j.complete("failure",new h)});f=function(a){e&&e.unregister(b);k();j.complete("success",
a)};a.addEventListener?a.addEventListener(c,f):a.addListener?a.addListener(c,f):a.attachEvent(c,f);e&&e.register(b)})};b.whenAll=function(){var a={},c;if(arguments.length==1){var e=arguments[0];b.isTask(e)?(a[0]=e,c=!0):(a=e,c=Object.prototype.toString.call(a)==="[object Array]")}else{for(e=0;e<arguments.length;e++)a[e]=arguments[e];c=!0}return b.create(function(e){var b={},f;for(f in a)b[a[f].id]=f;for(f in a){var i=a[f];i.status=="ready"&&i.start()}for(f in a)if(i=a[f],i.error){e.complete("failure",
i.error);return}var d=c?[]:{},g=function(c){if(c.error){for(var f in a)a[f].removeEventListener("complete",g);e.complete("failure",c.error)}else f=b[c.id],d[f]=c.result,delete a[f],delete b[c.id],h--,h==0&&e.complete("success",d)},h=0;for(f in a)i=a[f],i.status=="succeeded"?(d[f]=i.result,delete a[f],delete b[i.id]):(h++,i.addEventListener("complete",g));h==0&&e.complete("success",d)})};b.whenAny=function(){var a={};if(arguments.length==1){var c=arguments[0];b.isTask(c)?a[0]=c:a=c}else for(c=0;c<
arguments.length;c++)a[c]=arguments[c];return b.create(function(c){for(var b in a){var d=a[b];d.status=="ready"&&d.start()}for(b in a)if(d=a[b],d.error||d.status=="succeeded"){c.complete("success",{key:b,task:d});return}var f=function(b){for(var d in a)a[d].removeEventListener("complete",f);c.complete("success",{key:d,task:b})};for(b in a)a[b].addEventListener("complete",f)})};if(!d.Jscexify)d.Jscexify={};d=d.Jscexify;d.fromStandard=function(a){var c=m(arguments);return function(){var d=this,g=n(arguments,
a.length-1);return b.create(function(b){g.push(function(a,d){if(a)b.complete("failure",a);else if(c){for(var e={},g=0;g<c.length;g++)e[c[g]]=arguments[g+1];return b.complete("success",e)}else b.complete("success",d)});a.apply(d,g)})}};d.fromCallback=function(a){var c=m(arguments);return function(){var d=this,g=n(arguments,a.length-1);return b.create(function(b){g.push(function(a){if(c){for(var d={},e=0;e<c.length;e++)d[c[e]]=arguments[e];b.complete("success",d)}else b.complete("success",a)});a.apply(d,
g)})}};g.modules["async-powerpack"]=!0}},o=typeof define==="function"&&!define.amd,p=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=l;else if(o)define("jscex-async-powerpack",["jscex-async"],function(g,d,b){b.exports.init=l});else if(p)define("jscex-async-powerpack",["jscex-async"],function(){return{init:l}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');
l(Jscex)}})();
