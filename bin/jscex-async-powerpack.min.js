(function(){var k=function(h){if(h.length<=1)return null;for(var i=[],g=1;g<h.length;g++)i.push(h[g]);return i},l=function(h,i){for(var g=[],j=0;j<h.length;j++)g.push(h[j]);for(;g.length<i;)g.push(void 0);return g},m=function(h){if(!h.modules||!h.modules["async-powerpack"]){if(!h.modules||!h.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var i=h.Async,g=i.Task,j=i.CanceledError;i.sleep=function(a,c){return g.create(function(e){c&&c.isCancellationRequested&&
e.complete("failure",new j);var f,b;c&&(b=function(){clearTimeout(f);e.complete("failure",new j)});f=setTimeout(function(){c&&c.unregister(b);e.complete("success")},a);c&&c.register(b)})};i.onEvent=function(a,c,e){return g.create(function(f){e&&e.isCancellationRequested&&f.complete("failure",new j);var b=function(){a.removeEventListener?a.removeEventListener(c,d):a.removeListener?a.removeListener(c,d):a.detachEvent(c,d)},d,g;e&&(g=function(){b();f.complete("failure",new j)});d=function(a){e&&e.unregister(g);
b();f.complete("success",a)};a.addEventListener?a.addEventListener(c,d):a.addListener?a.addListener(c,d):a.attachEvent(c,d);e&&e.register(g)})};g.whenAll=function(){var a,c=!1;if(arguments.length==1){var e=arguments[0];if(g.isTask(e))return e;else a=e,c=Object.prototype.toString.call(a)==="[object Array]"}else{a=[];for(e=0;e<arguments.length;e++)a.push(arguments[e]);c=!0}return g.create(function(f){var b={};if(c)for(var d=0;d<a.length;d++)b[a[d].id]=d;else for(d in a)b[a[d].id]=d;for(var e in b)d=
a[b[e]],d.status=="ready"&&d.start();for(e in b)if(d=a[b[e]],d.error){f.complete("failure",d.error);return}var g=c?[]:{},i=function(d){if(d.error){for(var c in b)a[b[c]].removeEventListener("complete",i);f.complete("failure",d.error)}else g[b[d.id]]=d.result,delete b[d.id],h--,h==0&&f.complete("success",g)},h=0;for(e in b)d=a[b[e]],d.status=="succeeded"?(g[b[e]]=d.result,delete b[e]):(h++,d.addEventListener("complete",i));h==0&&f.complete("success",g)})};g.whenAny=function(){var a;if(arguments.length==
1){var c=arguments[0];if(g.isTask(c))return c;else a=c}else{a=[];for(c=0;c<arguments.length;c++)a.push(arguments[c])}return g.create(function(c){var f={};if(Object.prototype.toString.call(a)==="[object Array]")for(var b=0;b<a.length;b++)f[a[b].id]=b;else for(b in a)f[a[b].id]=b;for(var d in f)b=a[f[d]],b.status=="ready"&&b.start();for(d in f)if(b=a[f[d]],b.error||b.status=="succeeded"){c.complete("success",{key:f[d],task:b});return}var g=function(b){for(var d in f)a[f[d]].removeEventListener("complete",
g);c.complete("success",{key:f[b.id],task:b})};for(d in f)b=a[f[d]],b.addEventListener("complete",g)})};if(!i.Jscexify)i.Jscexify={};i=i.Jscexify;i.fromStandard=function(a){var c=k(arguments);return function(){var e=this,f=l(arguments,a.length-1);return g.create(function(b){f.push(function(a,g){if(a)b.complete("failure",a);else if(c){for(var e={},f=0;f<c.length;f++)e[c[f]]=arguments[f+1];return b.complete("success",e)}else b.complete("success",g)});a.apply(e,f)})}};i.fromCallback=function(a){var c=
k(arguments);return function(){var e=this,f=l(arguments,a.length-1);return g.create(function(b){f.push(function(a){if(c){for(var f={},e=0;e<c.length;e++)f[c[e]]=arguments[e];b.complete("success",f)}else b.complete("success",a)});a.apply(e,f)})}};h.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=m:m(Jscex)})();
