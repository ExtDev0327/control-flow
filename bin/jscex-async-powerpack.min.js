(function(){var l=function(g){if(g.length<=1)return null;for(var h=[],e=1;e<g.length;e++)h.push(g[e]);return h},m=function(g,h){for(var e=[],j=0;j<g.length;j++)e.push(g[j]);for(;e.length<h;)e.push(void 0);return e},n=function(g){if(!g.modules||!g.modules["async-powerpack"]){if(!g.modules||!g.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var h=g.Async,e=h.Task,j=h.CanceledError;h.sleep=function(b,f){return e.create(function(c){f&&f.isCancellationRequested&&
c.complete("failure",new j);var k,d;f&&(d=function(){clearTimeout(k);c.complete("failure",new j)});k=setTimeout(function(){f&&f.unregister(d);c.complete("success")},b);f&&f.register(d)})};h.onEvent=function(b,f,c){return e.create(function(k){c&&c.isCancellationRequested&&k.complete("failure",new j);var d=function(){b.removeEventListener?b.removeEventListener(f,a):b.removeListener?b.removeListener(f,a):b.detachEvent(f,a)},a,i;c&&(i=function(){d();k.complete("failure",new j)});a=function(a){c&&c.unregister(i);
d();k.complete("success",a)};b.addEventListener?b.addEventListener(f,a):b.addListener?b.addListener(f,a):b.attachEvent(f,a);c&&c.register(i)})};e.whenAll=function(){var b,f=!1;if(arguments.length==1){var c=arguments[0];if(e.isTask(c))return c;else b=c,f=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);f=!0}return e.create(function(c){var d={};if(f)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;for(var i in d)a=
b[d[i]],a.status=="ready"&&a.start();for(i in d)if(a=b[d[i]],a.error){c.complete("failure",a.error);return}var e=f?[]:{},h=function(a){if(a.error){for(var f in d)b[d[f]].removeEventListener("complete",h);c.complete("failure",a.error)}else e[d[a.id]]=a.result,delete d[a.id],g--,g==0&&c.complete("success",e)},g=0;for(i in d)a=b[d[i]],a.status=="succeeded"?(e[d[i]]=a.result,delete d[i]):(g++,a.addEventListener("complete",h));g==0&&c.complete("success",e)})};e.whenAny=function(){var b,f=!1;if(arguments.length==
1){var c=arguments[0];if(e.isTask(c))return c;else b=c,f=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);f=!0}return e.create(function(c){var d={};if(f)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;var e=function(a){for(var g in d)b[d[g]].removeEventListener("complete",e);f?c.complete("success",{index:d[a.id],task:a}):c.complete("success",{key:d[a.id],task:a})},g;for(g in d)switch(a=b[d[g]],a.status){case "ready":a.addEventListener("complete",
e);a.start();break;case "running":a.addEventListener("complete",e);break;default:e(a)}})};if(!h.Jscexify)h.Jscexify={};h=h.Jscexify;h.fromStandard=function(b){var f=l(arguments);return function(){var c=this,g=m(arguments,b.length-1);return e.create(function(d){g.push(function(a,b){if(a)d.complete("failure",a);else if(f){for(var c={},e=0;e<f.length;e++)c[f[e]]=arguments[e+1];return d.complete("success",c)}else d.complete("success",b)});b.apply(c,g)})}};h.fromCallback=function(b){var f=l(arguments);
return function(){var c=this,g=m(arguments,b.length-1);return e.create(function(d){g.push(function(a){if(f){for(var b={},c=0;c<f.length;c++)b[f[c]]=arguments[c];d.complete("success",b)}else d.complete("success",a)});b.apply(c,g)})}};g.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=n:n(Jscex)})();
