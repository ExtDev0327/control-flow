(function(){var k=function(h){if(h.length<=1)return null;for(var g=[],e=1;e<h.length;e++)g.push(h[e]);return g},l=function(h,g){for(var e=[],i=0;i<h.length;i++)e.push(h[i]);for(;e.length<g;)e.push(void 0);return e},m=function(h){if(!h.modules||!h.modules["async-powerpack"]){if(!h.modules||!h.modules.async)throw Error('Missing essential component, please initialize "jscex-async" module first.');var g=h.Async,e=g.Task,i=g.CanceledError;g.sleep=function(b,f){return e.create(function(c){f&&f.isCancellationRequested&&
c.complete("failure",new i);var j,d;f&&(d=function(){clearTimeout(j);c.complete("failure",new i)});j=setTimeout(function(){f&&f.unregister(d);c.complete("success")},b);f&&f.register(d)})};g.onEvent=function(b,f,c){return e.create(function(j){c&&c.isCancellationRequested&&j.complete("failure",new i);var d,a;c&&(a=function(){b.removeEventListener?b.removeEventListener(f,d):b.removeListener?b.removeListener(f,d):b.detachEvent(f,d);j.complete("failure",new i)});d=function(b){c&&c.unregister(a);j.complete("success",
b)};b.addEventListener?b.addEventListener(f,d):b.addListener?b.addListener(f,d):b.attachEvent(f,d);c&&c.register(a)})};e.whenAll=function(){var b,f=!1;if(arguments.length==1){var c=arguments[0];if(e.isTask(c))return c;else b=c,f=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);f=!0}return e.create(function(c){var d={};if(f)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;for(var e in d)a=b[d[e]],a.status=="ready"&&
a.start();for(e in d)if(a=b[d[e]],a.error){c.complete("failure",a.error);return}var g=f?[]:{},h=function(a){if(a.error){for(var f in d)b[d[f]].removeEventListener("complete",h);c.complete("failure",a.error)}else g[d[a.id]]=a.result,delete d[a.id],i--,i==0&&c.complete("success",g)},i=0;for(e in d)a=b[d[e]],a.status=="succeeded"?(g[d[e]]=a.result,delete d[e]):(i++,a.addEventListener("complete",h));i==0&&c.complete("success",g)})};e.whenAny=function(){var b,f=!1;if(arguments.length==1){var c=arguments[0];
if(e.isTask(c))return c;else b=c,f=Object.prototype.toString.call(b)==="[object Array]"}else{b=[];for(c=0;c<arguments.length;c++)b.push(arguments[c]);f=!0}return e.create(function(c){var d={};if(f)for(var a=0;a<b.length;a++)d[b[a].id]=a;else for(a in b)d[b[a].id]=a;var e=function(a){for(var g in d)b[d[g]].removeEventListener("complete",e);f?c.complete("success",{index:d[a.id],task:a}):c.complete("success",{key:d[a.id],task:a})},g;for(g in d)switch(a=b[d[g]],a.status){case "ready":a.addEventListener("complete",
e);a.start();break;case "running":a.addEventListener("complete",e);break;default:e(a)}})};if(!g.Jscexify)g.Jscexify={};g=g.Jscexify;g.fromStandard=function(b){var f=k(arguments);return function(){var c=this,g=l(arguments,b.length-1);return e.create(function(d){g.push(function(a,b){if(a)d.complete("failure",a);else if(f){for(var c={},e=0;e<f.length;e++)c[f[e]]=arguments[e+1];return d.complete("success",c)}else d.complete("success",b)});b.apply(c,g)})}};g.fromCallback=function(b){var f=k(arguments);
return function(){var c=this,g=l(arguments,b.length-1);return e.create(function(d){g.push(function(a){if(f){for(var b={},c=0;c<f.length;c++)b[f[c]]=arguments[c];d.complete("success",b)}else d.complete("success",a)});b.apply(c,g)})}};h.modules["async-powerpack"]=!0}};typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports?module.exports.init=m:m(Jscex)})();
