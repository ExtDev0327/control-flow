(function(){var l=function(){var a=0,b;b={};try{return Object.defineProperty(b,"value",{get:function(){if(a===0)throw Error("Execute too soon.");return a}}),a=1,b.value===1}catch(c){return!1}}(),g,h,i={},s=function(a){return a._typeId=="670a1076-712b-4edd-9b70-64b152fe1cd9"},k=i.CanceledError=function(){};k.prototype={isTypeOf:s,_typeId:"670a1076-712b-4edd-9b70-64b152fe1cd9",message:"The task has been cancelled."};var t=i.AggregateError=function(a){this.children=[];if(a)for(var b=0;b<a.length;b++)this.children.push(a[b])};
t.prototype={_typeId:"4a73efb8-c2e2-4305-a05c-72385288650a",message:"This is an error contains sub-errors, please check the 'children' collection for more details.",isTypeOf:function(a){return a._typeId=="4a73efb8-c2e2-4305-a05c-72385288650a"}};(i.CancellationToken=function(){}).prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,
1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var b=0;b<a.length;b++)try{a[b]()}catch(c){g.logger.warn("Cancellation handler threw an error: "+c)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new k;}};var p=function(){this._listeners={};this._firing=null};p.prototype={add:function(a,b){if(this._firing===a){var c=this;setTimeout(function(){c.add(a,b)},0)}else{var d=this._listeners[a];
d||(d=this._listeners[a]=[]);d.push(b)}},remove:function(a,b){if(this._firing===a){var c=this;setTimeout(function(){c.remove(a,b)},0)}else{var d=this._listeners[a];if(d){var f=d.indexOf(b);f>=0&&d.splice(f,1)}}},fire:function(a,b,c){var d=this._listeners[a];if(d){this._firing=a;for(var f=0;f<d.length;f++)try{d[f].call(b,c)}catch(m){g.logger.warn('An error occurred in "'+a+' listener": '+m)}this._firing=null}}};var n=new p,e=i.Task=function(a){this._delegate=a;this._eventManager=new p;this.status=
"ready"};e.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";try{this._delegate(this)}catch(a){this.status=="running"?this.complete("failure",a):g.logger.warn("An unexpected error occurred after the task is completed: "+a)}return this},complete:function(a,b){if(a!=="success"&&a!=="failure")throw Error("Unsupported type: "+a);if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');
var c=this._eventManager;this._eventManager=null;a==="success"?(this.status="succeeded",l?this._result=b:this.result=b,c.fire("success",this)):(this.status=s(b)?"canceled":"faulted",l?this._error=b:this.error=b,c.fire("failure",this));c.fire("complete",this);if(a==="failure"&&l&&!this._errorObserved){var d=this;this._unobservedTimeoutToken=setTimeout(function(){d._handleUnobservedError(b)},e.unobservedTimeout)}},observeError:function(){if(this.status==="ready"||this.status==="running")throw Error("The method could only be called when it's completed.");
if(!l)return this.error;var a=this._unobservedTimeoutToken;if(a)clearTimeout(a),this._unobservedTimeoutToken=null;this._errorObserved=!0;return this._error},_handleUnobservedError:function(a){this._unobservedTimeoutToken=null;var b={task:this,error:a,observed:!1};n.fire("unobservedError",e,b);if(!b.observed)throw a;},then:function(a){var b=this;return e.create(function(c){var d=function(){this.error?c.complete("failure",this.error):c.complete("success",this.result)},f=function(){if(this.error)return c.complete("failure",
this.error);var b;try{b=a(this.result)}catch(f){return c.complete("failure",f)}b.status=="ready"&&b.start();if(b.status=="running")b.on("complete",d);else d.call(b)};b.status=="ready"&&b.start();if(b.status=="running")b.on("complete",f);else f.call(b)})}};e.prototype.on=e.prototype.addEventListener=function(){var a=this._eventManager;if(!a)throw Error("Cannot add event listeners when the task is complete.");a.add.apply(a,arguments);return this};e.prototype.off=e.prototype.removeEventListener=function(){var a=
this._eventManager;if(!a)throw Error("All the event listeners have been removed when the task was complete.");a.remove.apply(a,arguments);return this};l&&(Object.defineProperty(e.prototype,"error",{get:function(){return this.observeError()}}),Object.defineProperty(e.prototype,"result",{get:function(){var a=this.observeError();if(a)throw a;return this._result}}));var u=function(){this.observeError()};e.on=e.addEventListener=function(){n.add.apply(n,arguments)};e.off=e.removeEventListener=function(){n.remove.apply(n,
arguments)};e.unobservedTimeout=1E4;var o=e.isTask=function(a){return a&&typeof a.start==="function"&&typeof a.addEventListener==="function"&&typeof a.removeEventListener==="function"&&typeof a.complete==="function"},v=e.create=function(a){return new e(a)},z=e.whenAll=function(){var a;if(arguments.length==1){var b=arguments[0];a=o(b)?[b]:b}else{a=Array(arguments.length);for(b=0;b<arguments.length;b++)a[b]=arguments[b]}return v(function(b){var d,f=function(){if(d)b.complete("failure",new t(d));else{var f=
h.map(a,function(a){return a.result});b.complete("success",f)}},m=0;h.each(a,function(b,c){if(c)if(o(c)||(a[b]=c=z(c)),c.status==="ready"&&c.start(),c.status==="running")m++,c.addEventListener("complete",function(){this.status!=="succeeded"&&(d||(d=[]),d.push(this.error));--m==0&&f()});else if(c.status==="faulted"||c.status==="canceled")d||(d=[]),d.push(c.error)});m==0&&f()})};e.whenAny=function(){var a={},b=!0;if(arguments.length==1){var c=arguments[0];o(c)?a[0]=c:(b=h.isArray(c),h.each(c,function(b,
c){o(c)&&(a[b]=c)}))}else for(c=0;c<arguments.length;c++){var d=arguments[c];o(d)&&(a[c]=d)}var f=b?function(a){return parseInt(a,10)}:function(a){return a};return v(function(b){if(h.isEmpty(a))return b.complete("failure","There's no valid input tasks.");var c;h.each(a,function(a,b){b.status==="ready"&&b.start();b.status!=="running"&&(b.observeError(),c||(c={key:f(a),task:b}))});if(c)return h.each(a,function(a,b){if(b.status==="running")b.on("failure",u)}),b.complete("success",c);var d=function(){this.observeError();
var c=this,e;h.each(a,function(a,b){c===b?e=a:(b.off("complete",d),b.on("failure",u))});b.complete("success",{key:f(e),task:this})};h.each(a,function(a){a.addEventListener("complete",d)})})};i.sleep=function(a,b){return e.create(function(c){b&&b.isCancellationRequested&&c.complete("failure",new k);var d,f;b&&(f=function(){clearTimeout(d);c.complete("failure",new k)});d=setTimeout(function(){b&&b.unregister(f);c.complete("success")},a);b&&b.register(f)})};i.onEvent=function(a,b,c){return e.create(function(d){c&&
c.isCancellationRequested&&d.complete("failure",new k);var f=function(){a.removeEventListener?a.removeEventListener(b,e):a.removeListener?a.removeListener(b,e):a.detachEvent(b,e)},e,g;c&&(g=function(){f();d.complete("failure",new k)});e=function(a){c&&c.unregister(g);f();d.complete("success",a)};a.addEventListener?a.addEventListener(b,e):a.addListener?a.addListener(b,e):a.attachEvent(b,e);c&&c.register(g)})};var q=i.AsyncBuilder=function(){};q.prototype={Start:function(a,b){return e.create(function(c){b.next(a,
function(a,b){if(a=="normal"||a=="return")c.complete("success",b);else if(a=="throw")c.complete("failure",b);else throw Error("Unsupported type: "+a);})})},Bind:function(a,b){return{next:function(c,d){var f=function(){if(this.error)d("throw",this.error);else{var a;try{a=b.call(c,this.result)}catch(f){d("throw",f);return}a.next(c,d)}};a.status=="ready"?(a.addEventListener("complete",f),a.start()):a.status=="running"?a.addEventListener("complete",f):f(a)}}}};var j=i.Binding={},w=function(a,b){for(var c=
[],d=0;d<a.length;d++)c.push(a[d]);for(;c.length<b;)c.push(void 0);return c},x=function(a){if(a.length<=1)return null;for(var b=[],c=1;c<a.length;c++)b.push(a[c]);return b};j.fromStandard=function(a){var b=x(arguments);return function(){var c=this,d=w(arguments,a.length-1);return e.create(function(f){d.push(function(a,c){if(a)f.complete("failure",a);else if(b){for(var d={},e=0;e<b.length;e++)d[b[e]]=arguments[e+1];return f.complete("success",d)}else f.complete("success",c)});a.apply(c,d)})}};j.fromCallback=
function(a){var b=x(arguments);return function(){var c=this,d=w(arguments,a.length-1);return e.create(function(e){d.push(function(a){if(b){for(var c={},d=0;d<b.length;d++)c[b[d]]=arguments[d];e.complete("success",c)}else e.complete("success",a)});a.apply(c,d)})}};var y=!!(typeof require==="function"&&typeof module!=="undefined"&&module.exports);j=!!(typeof require==="function"&&typeof define==="function"&&define.amd);var r=function(){g.define({name:"async",version:"0.7.0",require:y&&require,autoloads:["builderbase"],
dependencies:{builderbase:"~0.7.0"},init:function(){h=g._;h.each(g.BuilderBase.prototype,function(a,b){q.prototype[a]=b});g.Async=i;g.binders.async="$await";g.builders.async=new q}})};if(y){try{g=require("./wind-core")}catch(A){g=require("wind-core")}r()}else if(j)require(["wind-core"],function(a){g=a;r()});else{j=Function("return this")();if(!j.Wind)throw Error('Missing the root object, please load "wind" component first.');g=j.Wind;r()}})();
