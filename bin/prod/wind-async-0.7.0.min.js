(function(){var h,j,m=Function("return this")(),i={};if(m.__wind__async__taskIdSeed===void 0)m.__wind__async__taskIdSeed=0;var r=function(a){return a._typeId=="670a1076-712b-4edd-9b70-64b152fe1cd9"},k=i.CanceledError=function(){};k.prototype={isTypeOf:r,_typeId:"670a1076-712b-4edd-9b70-64b152fe1cd9",message:"The task has been cancelled."};var s=i.AggregateError=function(a){this.children=[];if(a)for(var b=0;b<a.length;b++)this.children.push(a[b])};s.prototype={_typeId:"4a73efb8-c2e2-4305-a05c-72385288650a",
message:"This is an error contains sub-errors, please check the 'children' collection for more details.",isTypeOf:function(a){return a._typeId=="4a73efb8-c2e2-4305-a05c-72385288650a"}};(i.CancellationToken=function(){}).prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=
!0;var a=this._handlers;delete this._handlers;for(var b=0;b<a.length;b++)try{a[b]()}catch(c){h.logger.warn("[WARNING] Cancellation handler threw an error: "+c)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new k;}};var f=i.Task=function(a){this.id=++__wind__async__taskIdSeed;this._delegate=a;this._listeners={};this.status="ready"};f.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";
this._delegate(this);return this},complete:function(a,b){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');var c=this._listeners;delete this._listeners;if(a=="success")this.result=b,this.status="succeeded",this._notify("success",c.success);else if(a=="failure")this.error=b,this.status=r(b)?"canceled":"faulted",this._notify("failure",c.failure);else throw Error("Unsupported type: "+a);this._notify("complete",c.complete);this.error&&!c.failure&&!c.complete&&
h.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(a,b){if(b)for(var c=0;c<b.length;c++)b[c].call(this)},addEventListener:function(a,b){if(!this._listeners)return this;this._listeners[a]||(this._listeners[a]=[]);this._listeners[a].push(b);return this},removeEventListener:function(a,b){if(!this._listeners)return this;var c=this._listeners[a];if(!c)return this;var d=c.indexOf(b);d>=0&&c.splice(d,1);return this},then:function(a){var b=this;return f.create(function(c){var d=
function(){this.error?c.complete("failure",this.error):c.complete("success",this.result)},e=function(){if(this.error)return c.complete("failure",this.error);var b;try{b=a(this.result)}catch(e){return c.complete("failure",e)}b.status=="ready"&&b.start();b.status=="running"?b.addEventListener("complete",d):d.call(b)};b.status=="ready"&&b.start();b.status=="running"?b.addEventListener("complete",e):e.call(b)})}};f.create=function(a){return new f(a)};var v=f.whenAll=function(){var a;if(arguments.length==
1){var b=arguments[0];a=f.isTask(b)?[b]:b}else{a=Array(arguments.length);for(b=0;b<arguments.length;b++)a[b]=arguments[b]}return f.create(function(b){var d={};j.each(a,function(b,c){c&&(f.isTask(c)||(a[b]=c=v(c)),d[c.id]=b)});j.each(d,function(b,c){var d=a[c];d.status==="ready"&&d.start()});var e=function(){var e=j.isArray(a)?Array(a.length):{},g=[];j.each(d,function(b,c){var d=a[c];d.error?g.push(d.error):e[c]=d.result});g.length>0?b.complete("failure",new s(g)):b.complete("success",e)},g=0;j.each(d,
function(b,c){var d=a[c];d.status=="running"&&(g++,d.addEventListener("complete",function(){--g==0&&e()}))});g==0&&e()})};f.whenAny=function(){var a={};if(arguments.length==1){var b=arguments[0];f.isTask(b)?a[0]=b:a=b}else for(b=0;b<arguments.length;b++)a[b]=arguments[b];return f.create(function(b){var d={},e;for(e in a)if(a.hasOwnProperty(e)){var g=a[e];f.isTask(g)&&(d[g.id]=e)}for(var l in d)g=a[d[l]],g.status=="ready"&&g.start();for(l in d)if(e=d[l],g=a[e],g.error||g.status=="succeeded"){b.complete("success",
{key:e,task:g});return}var h=function(){for(var e in d)a[d[e]].removeEventListener("complete",h);b.complete("success",{key:d[this.id],task:this})};for(l in d)a[d[l]].addEventListener("complete",h)})};f.isTask=function(a){return typeof a.start==="function"&&typeof a.addEventListener==="function"&&typeof a.removeEventListener==="function"&&typeof a.complete==="function"};i.sleep=function(a,b){return f.create(function(c){b&&b.isCancellationRequested&&c.complete("failure",new k);var d,e;b&&(e=function(){clearTimeout(d);
c.complete("failure",new k)});d=setTimeout(function(){b&&b.unregister(e);c.complete("success")},a);b&&b.register(e)})};i.onEvent=function(a,b,c){return f.create(function(d){c&&c.isCancellationRequested&&d.complete("failure",new k);var e=function(){a.removeEventListener?a.removeEventListener(b,g):a.removeListener?a.removeListener(b,g):a.detachEvent(b,g)},g,f;c&&(f=function(){e();d.complete("failure",new k)});g=function(a){c&&c.unregister(f);e();d.complete("success",a)};a.addEventListener?a.addEventListener(b,
g):a.addListener?a.addListener(b,g):a.attachEvent(b,g);c&&c.register(f)})};var o=i.AsyncBuilder=function(){};o.prototype={Start:function(a,b){return f.create(function(c){b.next(a,function(a,b){if(a=="normal"||a=="return")c.complete("success",b);else if(a=="throw")c.complete("failure",b);else throw Error("Unsupported type: "+a);})})},Bind:function(a,b){return{next:function(c,d){var e=function(){if(this.error)d("throw",this.error);else{var a;try{a=b.call(c,this.result)}catch(e){d("throw",e);return}a.next(c,
d)}};a.status=="ready"?(a.addEventListener("complete",e),a.start()):a.status=="running"?a.addEventListener("complete",e):e(a)}}}};var n=i.Binding={},t=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);for(;c.length<b;)c.push(void 0);return c},u=function(a){if(a.length<=1)return null;for(var b=[],c=1;c<a.length;c++)b.push(a[c]);return b};n.fromStandard=function(a){var b=u(arguments);return function(){var c=this,d=t(arguments,a.length-1);return f.create(function(e){d.push(function(a,c){if(a)e.complete("failure",
a);else if(b){for(var d={},f=0;f<b.length;f++)d[b[f]]=arguments[f+1];return e.complete("success",d)}else e.complete("success",c)});a.apply(c,d)})}};n.fromCallback=function(a){var b=u(arguments);return function(){var c=this,d=t(arguments,a.length-1);return f.create(function(e){d.push(function(a){if(b){for(var c={},d=0;d<b.length;d++)c[b[d]]=arguments[d];e.complete("success",c)}else e.complete("success",a)});a.apply(c,d)})}};var p=!!(typeof require==="function"&&typeof module!=="undefined"&&module.exports);
n=!!(typeof require==="function"&&typeof define==="function"&&define.amd);var q=function(){h.define({name:"async",version:"0.7.0",exports:p&&module.exports,require:p&&require,autoloads:["builderbase"],dependencies:{builderbase:"~0.6.5"},init:function(){j=h._;h._.each(h.BuilderBase.prototype,function(a,b){o.prototype[a]=b});h.Async=i;h.binders.async="$await";h.builders.async=new o}})};if(p){try{h=require("./wind")}catch(w){h=require("wind")}q()}else if(n)require(["wind"],function(a){h=a;q()});else{if(!m.Wind)throw Error('Missing the root object, please load "wind" component first.');
h=m.Wind;q()}})();
