(function(){var h,j,m=Function("return this")(),i={};if(m.__wind__async__taskIdSeed===void 0)m.__wind__async__taskIdSeed=0;var r=function(b){return b._typeId=="670a1076-712b-4edd-9b70-64b152fe1cd9"},k=i.CanceledError=function(){};k.prototype={isTypeOf:r,_typeId:"670a1076-712b-4edd-9b70-64b152fe1cd9",message:"The task has been cancelled."};var s=i.AggregateError=function(b){this.children=[];if(b)for(var a=0;a<b.length;a++)this.children.push(b[a])};s.prototype={_typeId:"4a73efb8-c2e2-4305-a05c-72385288650a",
message:"This is an error contains sub-errors, please check the 'children' collection for more details.",isTypeOf:function(b){return b._typeId=="4a73efb8-c2e2-4305-a05c-72385288650a"}};(i.CancellationToken=function(){}).prototype={register:function(b){this.isCancellationRequested&&b();if(!this._handlers)this._handlers=[];this._handlers.push(b)},unregister:function(b){this._handlers&&(b=this._handlers.indexOf(b),b>=0&&this._handlers.splice(b,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=
!0;var b=this._handlers;delete this._handlers;for(var a=0;a<b.length;a++)try{b[a]()}catch(c){h.logger.warn("[WARNING] Cancellation handler threw an error: "+c)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new k;}};var f=i.Task=function(b){this.id=++__wind__async__taskIdSeed;this._delegate=b;this._listeners={};this.status="ready"};f.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";
this._delegate(this);return this},complete:function(b,a){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');var c=this._listeners;delete this._listeners;if(b=="success")this.result=a,this.status="succeeded",this._notify("success",c.success);else if(b=="failure")this.error=a,this.status=r(a)?"canceled":"faulted",this._notify("failure",c.failure);else throw Error("Unsupported type: "+b);this._notify("complete",c.complete);this.error&&!c.failure&&!c.complete&&
h.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(b,a){if(a)for(var c=0;c<a.length;c++)a[c].call(this)},addEventListener:function(b,a){if(!this._listeners)return this;this._listeners[b]||(this._listeners[b]=[]);this._listeners[b].push(a);return this},removeEventListener:function(b,a){if(!this._listeners)return this;var c=this._listeners[b];if(!c)return this;var d=c.indexOf(a);d>=0&&c.splice(d,1);return this},then:function(b){var a=this;return f.create(function(c){var d=
function(){this.error?c.complete("failure",this.error):c.complete("success",this.result)},e=function(){if(this.error)return c.complete("failure",this.error);var a;try{a=b(this.result)}catch(e){return c.complete("failure",e)}a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",d):d.call(a)};a.status=="ready"&&a.start();a.status=="running"?a.addEventListener("complete",e):e.call(a)})}};f.create=function(b){return new f(b)};var v=f.whenAll=function(){var b;if(arguments.length==
1){var a=arguments[0];b=f.isTask(a)?[a]:a}else{b=Array(arguments.length);for(a=0;a<arguments.length;a++)b[a]=arguments[a]}return f.create(function(a){var d={};j.each(b,function(a,c){c&&(f.isTask(c)||(b[a]=c=v(c)),d[c.id]=a)});j.each(d,function(a){a=b[a];a.status==="ready"&&a.start()});var e=function(){var e=j.isArray(b)?Array(b.length):{},g=[];j.each(d,function(a){var c=b[a];c.error?g.push(c.error):e[a]=c.result});g.length>0?a.complete("failure",new s(g)):a.complete("success",e)},g=0;j.each(d,function(a){a=
b[a];a.status=="running"&&(g++,a.addEventListener("complete",function(){--g==0&&e()}))});g==0&&e()})};f.whenAny=function(){var b={};if(arguments.length==1){var a=arguments[0];f.isTask(a)?b[0]=a:b=a}else for(a=0;a<arguments.length;a++)b[a]=arguments[a];return f.create(function(a){var d={},e;for(e in b)if(b.hasOwnProperty(e)){var g=b[e];f.isTask(g)&&(d[g.id]=e)}for(var l in d)g=b[d[l]],g.status=="ready"&&g.start();for(l in d)if(e=d[l],g=b[e],g.error||g.status=="succeeded"){a.complete("success",{key:e,
task:g});return}var h=function(){for(var e in d)b[d[e]].removeEventListener("complete",h);a.complete("success",{key:d[this.id],task:this})};for(l in d)b[d[l]].addEventListener("complete",h)})};f.isTask=function(b){return typeof b.start==="function"&&typeof b.addEventListener==="function"&&typeof b.removeEventListener==="function"&&typeof b.complete==="function"};i.sleep=function(b,a){return f.create(function(c){a&&a.isCancellationRequested&&c.complete("failure",new k);var d,e;a&&(e=function(){clearTimeout(d);
c.complete("failure",new k)});d=setTimeout(function(){a&&a.unregister(e);c.complete("success")},b);a&&a.register(e)})};i.onEvent=function(b,a,c){return f.create(function(d){c&&c.isCancellationRequested&&d.complete("failure",new k);var e=function(){b.removeEventListener?b.removeEventListener(a,g):b.removeListener?b.removeListener(a,g):b.detachEvent(a,g)},g,f;c&&(f=function(){e();d.complete("failure",new k)});g=function(a){c&&c.unregister(f);e();d.complete("success",a)};b.addEventListener?b.addEventListener(a,
g):b.addListener?b.addListener(a,g):b.attachEvent(a,g);c&&c.register(f)})};var o=i.AsyncBuilder=function(){};o.prototype={Start:function(b,a){return f.create(function(c){a.next(b,function(a,b){if(a=="normal"||a=="return")c.complete("success",b);else if(a=="throw")c.complete("failure",b);else throw Error("Unsupported type: "+a);})})},Bind:function(b,a){return{next:function(c,d){var e=function(){if(this.error)d("throw",this.error);else{var b;try{b=a.call(c,this.result)}catch(e){d("throw",e);return}b.next(c,
d)}};b.status=="ready"?(b.addEventListener("complete",e),b.start()):b.status=="running"?b.addEventListener("complete",e):e(b)}}}};var n=i.Binding={},t=function(b,a){for(var c=[],d=0;d<b.length;d++)c.push(b[d]);for(;c.length<a;)c.push(void 0);return c},u=function(b){if(b.length<=1)return null;for(var a=[],c=1;c<b.length;c++)a.push(b[c]);return a};n.fromStandard=function(b){var a=u(arguments);return function(){var c=this,d=t(arguments,b.length-1);return f.create(function(e){d.push(function(b,c){if(b)e.complete("failure",
b);else if(a){for(var d={},f=0;f<a.length;f++)d[a[f]]=arguments[f+1];return e.complete("success",d)}else e.complete("success",c)});b.apply(c,d)})}};n.fromCallback=function(b){var a=u(arguments);return function(){var c=this,d=t(arguments,b.length-1);return f.create(function(e){d.push(function(b){if(a){for(var c={},d=0;d<a.length;d++)c[a[d]]=arguments[d];e.complete("success",c)}else e.complete("success",b)});b.apply(c,d)})}};var p=!!(typeof require==="function"&&typeof module!=="undefined"&&module.exports);
n=!!(typeof require==="function"&&typeof define==="function"&&define.amd);var q=function(){h.define({name:"async",version:"0.7.0",exports:p&&module.exports,require:p&&require,autoloads:["builderbase"],dependencies:{builderbase:"~0.6.5"},init:function(){j=h._;j.each(h.BuilderBase.prototype,function(b,a){o.prototype[b]=a});h.Async=i;h.binders.async="$await";h.builders.async=new o}})};if(p){try{h=require("./wind")}catch(w){h=require("wind")}q()}else if(n)require(["wind"],function(b){h=b;q()});else{if(!m.Wind)throw Error('Missing the root object, please load "wind" component first.');
h=m.Wind;q()}})();
