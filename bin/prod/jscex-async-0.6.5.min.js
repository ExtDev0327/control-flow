(function(){var d,k=function(a){return a._typeId=="670a1076-712b-4edd-9b70-64b152fe1cd9"},h=function(){};h.prototype={isTypeOf:k,_typeId:"670a1076-712b-4edd-9b70-64b152fe1cd9",message:"The task has been cancelled."};var f=Function("return this")();if(f.__jscex__async__taskIdSeed===void 0)f.__jscex__async__taskIdSeed=0;var l=function(){};l.prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&
(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var c=0;c<a.length;c++)try{a[c]()}catch(b){d.logger.warn("[WARNING] Cancellation handler threw an error: "+b)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new h;}};var e=function(a){this.id=++__jscex__async__taskIdSeed;this._delegate=a;this._listeners={};this.status="ready"};
e.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";this._delegate(this);return this},complete:function(a,c){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');var b=this._listeners;delete this._listeners;if(a=="success")this.result=c,this.status="succeeded",this._notify("success",b.success);else if(a=="failure")this.error=c,this.status=k(c)?"canceled":"faulted",this._notify("failure",
b.failure);else throw Error("Unsupported type: "+a);this._notify("complete",b.complete);this.error&&!b.failure&&!b.complete&&d.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(a,c){if(c)for(var b=0;b<c.length;b++)c[b].call(this)},addEventListener:function(a,c){if(!this._listeners)return this;this._listeners[a]||(this._listeners[a]=[]);this._listeners[a].push(c);return this},removeEventListener:function(a,c){if(!this._listeners)return this;var b=this._listeners[a];
if(!b)return this;var d=b.indexOf(c);d>=0&&b.splice(d,1);return this}};e.create=function(a){return new e(a)};e.isTask=function(a){return typeof a.start==="function"&&typeof a.addEventListener==="function"&&typeof a.removeEventListener==="function"&&typeof a.complete==="function"};var g=function(){};g.prototype={Start:function(a,c){return e.create(function(b){c.next(a,function(a,c){if(a=="normal"||a=="return")b.complete("success",c);else if(a=="throw")b.complete("failure",c);else throw Error("Unsupported type: "+
a);})})},Bind:function(a,c){return{next:function(b,d){var e=function(){if(this.error)d("throw",this.error);else{var a;try{a=c.call(b,this.result)}catch(e){d("throw",e);return}a.next(b,d)}};a.status=="ready"?(a.addEventListener("complete",e),a.start()):a.status=="running"?a.addEventListener("complete",e):e(a)}}}};var i=!!(typeof require==="function"&&typeof module!=="undefined"&&module.exports),m=!!(typeof require==="function"&&typeof define==="function"&&define.amd),j=function(){d.define({name:"async",
version:"0.6.5",exports:i&&module.exports,require:i&&require,autoloads:["builderbase"],dependencies:{builderbase:"~0.6.5"},init:function(){d._.each(d.BuilderBase.prototype,function(a,b){g.prototype[a]=b});if(!d.Async)d.Async={};var a=d.Async;a.CancellationToken=l;a.CanceledError=h;a.Task=e;a.AsyncBuilder=g;d.binders.async="$await";d.builders.async=new g}})};if(i){try{d=require("./jscex")}catch(n){d=require("jscex")}j()}else if(m)require(["jscex"],function(a){d=a;j()});else{if(!f.Jscex)throw Error('Missing the root object, please load "jscex" component first.');
d=f.Jscex;j()}})();
