(function(){var j=function(){};j.prototype.isCancellation=!0;typeof __jscex__taskIdSeed==="undefined"&&(__jscex__taskIdSeed=0);var k=typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports,g=function(b,h){h||(h=b);h.binders&&(h.binders.async="$await");if(!b.modules)b.modules={};if(!b.modules.async){var g=function(){};g.prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&
(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var c=0;c<a.length;c++)try{a[c]()}catch(e){b.log("WARNING: Cancellation handler threw an error: "+e)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new j;}};var f=function(a){this.id=++__jscex__taskIdSeed;this._delegate=a;this._listeners={};this.status="ready"};f.prototype=
{start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";this._delegate(this)},complete:function(a,c){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');if(a=="success")this.result=c,this.status="succeeded",this._notify("success");else if(a=="failure")this.error=c,this.status=c.isCancellation?"canceled":"failed",this._notify("failure");else throw Error("Unsupported type: "+a);this._notify("complete");
delete this._listeners},_notify:function(a){var c=this._listeners[a];if(c)for(var e=0;e<c.length;e++)try{c[e](this)}catch(l){b.log("WARNING: the task's "+a+" listener threw an error: "+l)}},addEventListener:function(a,c){if(!this._listeners)throw Error('Listeners can only be added in "ready" or "running" status.');this._listeners[a]||(this._listeners[a]=[]);this._listeners[a].push(c)},removeEventListener:function(a,c){if(!this._listeners)throw Error('Listeners can only be removed in "ready" or "running" status.');
var e=this._listeners[a];if(e){var b=e.indexOf(c);b>=0&&e.splice(b,1)}}};f.create=function(a){return new f(a)};var d=function(){};d.prototype={Start:function(a,c){return f.create(function(b){c.next(a,function(a,c){if(a=="normal"||a=="return")b.complete("success",c);else if(a=="throw")b.complete("failure",c);else throw Error("Unsupported type: "+a);})})},Bind:function(a,c){return{next:function(b,f){var d=function(a){if(a.error)f("throw",a.error);else{var d;try{d=c.call(b,a.result)}catch(g){f("throw",
g);return}d.next(b,f)}};a.status=="ready"?(a.addEventListener("complete",d),a.start()):a.status=="running"?a.addEventListener("complete",d):d(a)}}}};k?require("./jscex-builderbase").standardizeBuilder(d.prototype):b.standardizeBuilder(d.prototype);if(!b.Async)b.Async={};var i=b.Async;i.CancellationToken=g;i.CanceledError=j;i.Task=f;i.Builder=d;if(!b.builders)b.builders=[];b.builders.async=new d;b.modules.async=!0}};k?module.exports.init=g:g(Jscex)})();
