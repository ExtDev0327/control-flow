(function(){var k=function(){};k.prototype={isCancellation:!0,message:"The task has been cancelled."};typeof __jscex__taskIdSeed==="undefined"&&(__jscex__taskIdSeed=0);var l=typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports,g=function(b,h){h||(h=b);if(!b.modules||!b.modules.builderbase)if(l)require("./jscex-builderbase").init(b);else throw Error('Missing essential component, please initialize "builderbase" module first.');h.binders&&(h.binders.async="$await");if(!b.modules.async){var g=
function(){};g.prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=[];this._handlers.push(a)},unregister:function(a){this._handlers&&(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var c=0;c<a.length;c++)try{a[c]()}catch(e){b.log("WARNING: Cancellation handler threw an error: "+e)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new k;
}};var d=function(a){this.id=++__jscex__taskIdSeed;this._delegate=a;this._listeners={};this.status="ready"};d.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";this._delegate(this)},complete:function(a,c){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');if(a=="success")this.result=c,this.status="succeeded",this._notify("success");else if(a=="failure")this.error=
c,this.status=c.isCancellation?"canceled":"failed",this._notify("failure");else throw Error("Unsupported type: "+a);this._notify("complete");delete this._listeners},_notify:function(a){var c=this._listeners[a];if(c)for(var e=0;e<c.length;e++)try{c[e](this)}catch(f){b.log("WARNING: the task's "+a+" listener threw an error: "+f)}},addEventListener:function(a,c){if(!this._listeners)throw Error('Listeners can only be added in "ready" or "running" status.');this._listeners[a]||(this._listeners[a]=[]);
this._listeners[a].push(c)},removeEventListener:function(a,c){if(!this._listeners)throw Error('Listeners can only be removed in "ready" or "running" status.');var b=this._listeners[a];if(b){var f=b.indexOf(c);f>=0&&b.splice(f,1)}}};d.create=function(a){return new d(a)};var i=function(){};i.prototype={Start:function(a,b){return d.create(function(e){b.next(a,function(a,b){if(a=="normal"||a=="return")e.complete("success",b);else if(a=="throw")e.complete("failure",b);else throw Error("Unsupported type: "+
a);})})},Bind:function(a,b){return{next:function(e,f){var d=function(a){if(a.error)f("throw",a.error);else{var d;try{d=b.call(e,a.result)}catch(g){f("throw",g);return}d.next(e,f)}};a.status=="ready"?(a.addEventListener("complete",d),a.start()):a.status=="running"?a.addEventListener("complete",d):d(a)}}}};b.standardizeBuilder(i.prototype);if(!b.Async)b.Async={};var j=b.Async;j.CancellationToken=g;j.CanceledError=k;j.Task=d;j.Builder=i;if(!b.builders)b.builders={};b.builders.async=new i;b.modules.async=
!0}};l?module.exports.init=g:g(Jscex)})();
