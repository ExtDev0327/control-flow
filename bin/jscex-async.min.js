(function(){var k=function(a){return a._typeId=="670a1076-712b-4edd-9b70-64b152fe1cd9"},j=function(){};j.prototype={isTypeOf:k,_typeId:"670a1076-712b-4edd-9b70-64b152fe1cd9",message:"The task has been cancelled."};typeof __jscex__async__taskIdSeed==="undefined"&&(__jscex__async__taskIdSeed=0);var m=function(a){return typeof a.start==="function"&&typeof a.addEventListener==="function"&&typeof a.removeEventListener==="function"&&typeof a.complete==="function"},i=function(a){if(!a.modules.async){var f=
function(){};f.prototype={register:function(b){this.isCancellationRequested&&b();if(!this._handlers)this._handlers=[];this._handlers.push(b)},unregister:function(b){this._handlers&&(b=this._handlers.indexOf(b),b>=0&&this._handlers.splice(b,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var b=this._handlers;delete this._handlers;for(var e=0;e<b.length;e++)try{b[e]()}catch(c){a.logger.warn("[WARNING] Cancellation handler threw an error: "+c)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new j;
}};var d=function(b){this.id=++__jscex__async__taskIdSeed;this._delegate=b;this._listeners={};this.status="ready"};d.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";this._delegate(this);return this},complete:function(b,e){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');var c=this._listeners;delete this._listeners;if(b=="success")this.result=e,this.status="succeeded",
this._notify("success",c.success);else if(b=="failure")this.error=e,this.status=k(e)?"canceled":"faulted",this._notify("failure",c.failure);else throw Error("Unsupported type: "+b);this._notify("complete",c.complete);this.error&&!c.failure&&!c.complete&&a.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(b,a){if(a)for(var c=0;c<a.length;c++)a[c].call(this)},addEventListener:function(b,a){if(!this._listeners)return this;this._listeners[b]||(this._listeners[b]=[]);
this._listeners[b].push(a);return this},removeEventListener:function(a,e){if(!this._listeners)return this;var c=this._listeners[a];if(!c)return this;var l=c.indexOf(e);l>=0&&c.splice(l,1);return this}};d.create=function(a){return new d(a)};d.isTask=m;var h=function(){};h.prototype={Start:function(a,e){return d.create(function(c){e.next(a,function(a,b){if(a=="normal"||a=="return")c.complete("success",b);else if(a=="throw")c.complete("failure",b);else throw Error("Unsupported type: "+a);})})},Bind:function(a,
e){return{next:function(c,d){var f=function(){if(this.error)d("throw",this.error);else{var a;try{a=e.call(c,this.result)}catch(b){d("throw",b);return}a.next(c,d)}};a.status=="ready"?(a.addEventListener("complete",f),a.start()):a.status=="running"?a.addEventListener("complete",f):f(a)}}}};for(var g in a.BuilderBase.prototype)h.prototype[g]=a.BuilderBase.prototype[g];if(!a.Async)a.Async={};g=a.Async;g.CancellationToken=f;g.CanceledError=j;g.Task=d;g.AsyncBuilder=h;if(!a.builders)a.builders={};a.binders.async=
"$await";a.builders.async=new h;a.modules.async=!0}},n=typeof define==="function"&&!define.amd,o=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=function(a){if(!a.modules.builderbase){if(typeof __dirname==="string")try{require.paths.unshift(__dirname)}catch(f){try{module.paths.unshift(__dirname)}catch(d){}}require("jscex-builderbase").init(a)}i(a)};else if(n)define("jscex-async",["jscex-builderbase"],
function(a,f,d){d.exports.init=function(d){d.modules.builderbase||a("jscex-builderbase").init(d);i(d)}});else if(o)define("jscex-async",["jscex-builderbase"],function(a){return{init:function(f){f.modules.builderbase||a.init(f);i(f)}}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');if(!Jscex.modules.builderbase)throw Error('Missing essential components, please initialize "builderbase" module first.');i(Jscex)}})();
