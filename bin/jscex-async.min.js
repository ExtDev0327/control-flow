(function(){var j=function(){};j.prototype={isCancellation:!0,message:"The task has been cancelled."};typeof __jscex__async__taskIdSeed==="undefined"&&(__jscex__async__taskIdSeed=0);var l=function(b){return typeof b.start==="function"&&typeof b.addEventListener==="function"&&typeof b.removeEventListener==="function"&&typeof b.complete==="function"},i=function(b){if(!b.modules.async){var c=function(){};c.prototype={register:function(a){this.isCancellationRequested&&a();if(!this._handlers)this._handlers=
[];this._handlers.push(a)},unregister:function(a){this._handlers&&(a=this._handlers.indexOf(a),a>=0&&this._handlers.splice(a,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var a=this._handlers;delete this._handlers;for(var f=0;f<a.length;f++)try{a[f]()}catch(d){b.logger.warn("[WARNING] Cancellation handler threw an error: "+d)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new j;}};var e=function(a){this.id=++__jscex__async__taskIdSeed;
this._delegate=a;this._listeners={};this.status="ready"};e.prototype={start:function(){if(this.status!="ready")throw Error('Task can only be started in "ready" status.');this.status="running";this._delegate(this)},complete:function(a,f){if(this.status!="running")throw Error('The "complete" method can only be called in "running" status.');var d=this._listeners;delete this._listeners;if(a=="success")this.result=f,this.status="succeeded",this._notify(d.success);else if(a=="failure")this.error=f,this.status=
f.isCancellation?"canceled":"faulted",this._notify(d.failure);else throw Error("Unsupported type: "+a);this._notify(d.complete);this.error&&!d.failure&&!d.complete&&b.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(a){if(a)for(var f=0;f<a.length;f++)try{a[f](this)}catch(d){b.logger.warn("[WARNING] The task's "+ev+" listener threw an error: "+d)}},addEventListener:function(a,b){this._listeners&&(this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b))},
removeEventListener:function(a,b){if(this._listeners){var d=this._listeners[a];if(d){var k=d.indexOf(b);k>=0&&d.splice(k,1)}}}};e.create=function(a){return new e(a)};e.isTask=l;var h=function(){};h.prototype={Start:function(a,b){return e.create(function(d){b.next(a,function(a,b){if(a=="normal"||a=="return")d.complete("success",b);else if(a=="throw")d.complete("failure",b);else throw Error("Unsupported type: "+a);})})},Bind:function(a,b){return{next:function(d,e){var c=function(a){if(a.error)e("throw",
a.error);else{var c;try{c=b.call(d,a.result)}catch(h){e("throw",h);return}c.next(d,e)}};a.status=="ready"?(a.addEventListener("complete",c),a.start()):a.status=="running"?a.addEventListener("complete",c):c(a)}}}};for(var g in b.BuilderBase.prototype)h.prototype[g]=b.BuilderBase.prototype[g];if(!b.Async)b.Async={};g=b.Async;g.CancellationToken=c;g.CanceledError=j;g.Task=e;g.AsyncBuilder=h;if(!b.builders)b.builders={};b.binders.async="$await";b.builders.async=new h;b.modules.async=!0}},m=typeof define===
"function"&&!define.amd,n=typeof require==="function"&&typeof define==="function"&&define.amd;if(typeof require==="function"&&typeof module!=="undefined"&&module.exports)module.exports.init=function(b){if(!b.modules.builderbase){if(typeof __dirname==="string")try{require.paths.unshift(__dirname)}catch(c){try{module.paths.unshift(__dirname)}catch(e){}}require("jscex-builderbase").init(b)}i(b)};else if(m)define("jscex-async",["jscex-builderbase"],function(b,c,e){e.exports.init=function(c){c.modules.builderbase||
b("jscex-builderbase").init(c);i(c)}});else if(n)define("jscex-async",["jscex-builderbase"],function(b){return{init:function(c){c.modules.builderbase||b.init(c);i(c)}}});else{if(typeof Jscex==="undefined")throw Error('Missing the root object, please load "jscex" module first.');if(!Jscex.modules.builderbase)throw Error('Missing essential components, please initialize "builderbase" module first.');i(Jscex)}})();
